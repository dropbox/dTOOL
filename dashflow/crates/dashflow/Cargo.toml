[package]
name = "dashflow"
version.workspace = true
edition.workspace = true
rust-version.workspace = true
description = "DashFlow agent orchestration framework - stateful graph-based agent workflows"
authors.workspace = true
repository.workspace = true
homepage.workspace = true
keywords.workspace = true
categories.workspace = true
license.workspace = true

[dependencies]
# Internal dependencies
dashflow-macros.workspace = true
dashflow-derive.workspace = true
dashflow-streaming = { workspace = true, optional = true }
dashflow-observability = { workspace = true, optional = true }
dashflow-langsmith = { workspace = true, optional = true }
dashflow-module-discovery.workspace = true

# Async
async-trait = { workspace = true }
tokio = { workspace = true }
futures = { workspace = true }
async-stream = { workspace = true }

# Serialization
serde = { workspace = true, features = ["derive"] }
serde_json = { workspace = true }
serde_yml = { workspace = true }
toml = { workspace = true }
ini = { workspace = true }
schemars = { workspace = true }
jsonschema = { workspace = true }

# Error handling
thiserror = { workspace = true }

# Logging/Tracing
tracing = { workspace = true }

# Utilities
uuid = { workspace = true, features = ["v4", "v5", "serde"] }
chrono = { workspace = true }
dashmap = { workspace = true }
parking_lot = { workspace = true }
notify = { workspace = true }
lru = { workspace = true }
rayon = { workspace = true }
rand = { workspace = true }

# Observability
prometheus = { workspace = true }

# Template engine
tera = { workspace = true }
regex = { workspace = true }

# Graph algorithms
petgraph = "0.6"

# Checkpointing
bincode = "1.3"
crc32fast = "1.4"
fs2 = "0.4"  # Cross-process file locking

# CSV parsing
csv = { workspace = true }

# PDF text extraction
pdf-extract = "0.7"

# HTTP client
reqwest = { workspace = true, features = ["blocking", "json", "multipart"] }

# MIME type detection for Blob
mime_guess = "2.0"

# Directory walking for document loaders
walkdir = { workspace = true }

# Home directory resolution for package registry
dirs = "5.0"

# HTML parsing
html2text = "0.12"
scraper = { workspace = true }

# Markdown parsing
pulldown-cmark = "0.12"

# XML parsing
quick-xml = "0.36"

# Base64 encoding
base64 = { workspace = true }

# Archive formats
zip = { workspace = true }
tar = { workspace = true }
flate2 = { workspace = true }

# Excel file support
calamine = "0.26"

# HTML entity decoding
html-escape = "0.2"

# URL encoding
urlencoding = "2.1"

# Hashing
sha1 = "0.10"
sha2 = { workspace = true }
blake2 = "0.10"
blake3 = "1.5"  # Fast BLAKE3 hashing for packages
hex = { workspace = true }

# Compression (M-671: checkpoint compression)
zstd = { workspace = true }

# Cryptographic signatures (package trust system)
ed25519-dalek = { version = "2.1", features = ["rand_core", "pem"] }
p256 = { version = "0.13", features = ["ecdsa", "pem"] }
rsa = { version = "0.9", features = ["sha2", "pem"] }  # NOTE: RUSTSEC-2023-0071 Marvin timing attack, no fix available
signature = "2.2"  # Common signature traits
pkcs8 = { version = "0.10", features = ["pem"] }  # Key encoding
rand_core = "0.6"  # Random number generation for key generation

# Symmetric encryption for checkpoint encryption
chacha20poly1305 = { version = "0.10", optional = true }
argon2 = { version = "0.5", optional = true }

# Colored output for console tracer
colored = { workspace = true }

# SQLite support for iMessage chat loader
rusqlite = { workspace = true }

# WAL compaction (segments â†’ Parquet)
arrow = { workspace = true }
parquet = { workspace = true }

# SIMD-accelerated vector operations
simsimd = { version = "6.5", optional = true }

# Math expression evaluation
fasteval2 = "2.1"

# A/B testing statistical analysis
statrs = "0.18"

# Token counting for context limit enforcement
tiktoken-rs = { workspace = true }

# Heap profiling (dev only)
dhat = { version = "0.3", optional = true }

# MCP Self-Documentation Server (optional)
axum = { workspace = true, optional = true }
tokio-stream = { workspace = true, optional = true }

# Network coordination server
tower = { workspace = true, optional = true }
tower-http = { workspace = true, optional = true }

# mDNS discovery
libmdns = { version = "0.10", optional = true }
mdns = { version = "3.0", optional = true }
if-addrs = { version = "0.13", optional = true }

# System introspection (colony module)
hostname = "0.4"
users = "0.11"
sysinfo = "0.32"  # CPU usage, network stats, memory info

[features]
default = ["simd"]
dashstream = ["dashflow-streaming"]
observability = ["dashflow-observability"]
tracing = ["dashflow-langsmith"]
simd = ["simsimd"]
dhat-heap = ["dhat"]
mcp-server = ["axum", "tokio-stream"]
network = ["axum", "tokio-stream", "tower", "tower-http", "libmdns", "mdns", "if-addrs"]
encryption = ["chacha20poly1305", "argon2"]
# Enable test utilities like ToolEmulatorMiddleware for external crate testing
testing = []
# Enable deprecated stub retrievers for backward compatibility (ElasticSearchBM25Retriever, PineconeHybridSearchRetriever, WeaviateHybridSearchRetriever)
# These are configuration-only stubs that return errors when called. Use the dedicated crates instead.
stub-retrievers = []

[build-dependencies]
# Module discovery at build time - consolidates with dashflow-module-discovery crate
# (M-601: Eliminates code duplication between build.rs and dashflow-module-discovery)
dashflow-module-discovery.workspace = true

[dev-dependencies]
tokio = { workspace = true }
criterion = { workspace = true, features = ["async_tokio"] }
proptest = { workspace = true }
tempfile = { workspace = true }
dashflow-postgres-checkpointer = { path = "../dashflow-postgres-checkpointer" }
dashflow-macros = { path = "../dashflow-macros" }
dashflow-openai = { path = "../dashflow-openai" }
tracing-subscriber = { workspace = true }

[[example]]
name = "dashstream_integration"
required-features = ["dashstream"]

[[example]]
name = "dashstream_quality_monitoring"
required-features = ["dashstream"]

[[example]]
name = "metrics_example"
required-features = ["observability", "dashflow-observability/metrics-server"]

[[example]]
name = "cost_tracking_example"
required-features = ["observability"]

[[example]]
name = "cost_monitoring_example"
required-features = ["observability"]

[[example]]
name = "quality_gate_demonstration"
required-features = ["dashstream"]

[[example]]
name = "streaming_node"
required-features = ["dashstream"]

[[example]]
name = "finetune_dataset_export"
required-features = ["dashstream"]

[[example]]
name = "grpo_multihop_qa"
required-features = ["dashstream"]

[[bench]]
name = "graph_benchmarks"
harness = false

[[bench]]
name = "self_improvement_bench"
harness = false

[lints]
workspace = true
