[package]
name = "dashflow-streaming"
version.workspace = true
edition.workspace = true
rust-version.workspace = true
authors = ["Andrew Yates <ayates@dropbox.com>", "Dropbox"]
description = "Ultra-efficient streaming telemetry for DashFlow using Protocol Buffers"
repository.workspace = true
homepage.workspace = true
keywords.workspace = true
categories.workspace = true
license = "Apache-2.0"

[dependencies]
# Protobuf support
prost = { workspace = true }
prost-types = "0.13"

# Compression
zstd = { workspace = true }

# Hashing
sha2 = { workspace = true }

# Serialization
serde.workspace = true
serde_json = { workspace = true }
json-patch = { workspace = true }
hex = { workspace = true }
base64 = { workspace = true }

# Error handling
thiserror = { workspace = true }
anyhow = { workspace = true }

# UUID generation
uuid.workspace = true

# Time handling
chrono = { workspace = true }

# Kafka support
rdkafka = { workspace = true }
rskafka = { version = "0.5", features = ["transport-tls"] }  # Pure Rust Kafka with TLS support
rustls = "0.21"  # TLS for rskafka consumer
rustls-pemfile = "1.0"  # PEM file parsing for TLS certificates
webpki-roots = "0.25"  # System root certificates
tokio = { workspace = true }

# Async trait support
async-trait = { workspace = true }

# CLI support
clap = { workspace = true }

# Metrics
prometheus = { workspace = true }

# Redis for distributed rate limiting
redis = { workspace = true, features = ["tokio-comp", "connection-manager", "script"] }

# Concurrent data structures (non-blocking)
dashmap = { workspace = true }

# SQLite for lightweight persistence backend
rusqlite = { workspace = true }

# Distributed tracing (Issue #14)
tracing = { workspace = true }
# S-21: tracing-subscriber for binary initialization
tracing-subscriber = { workspace = true }
opentelemetry = { workspace = true }
opentelemetry_sdk = { workspace = true }

# Random number generation (for retry jitter)
rand = { workspace = true }

# HTTP server (for health endpoints in binaries)
axum = { workspace = true }

[build-dependencies]
prost-build = { workspace = true }

[dev-dependencies]
criterion = { workspace = true }
kafka = "0.10"
quickcheck = "1.0"
quickcheck_macros = "1.0"
tempfile = { workspace = true }
testcontainers = { workspace = true }
testcontainers-modules = { version = "0.13", features = ["kafka", "redis"] }
reqwest = { workspace = true }
dashflow = { path = "../dashflow" }
dashflow-openai = { path = "../dashflow-openai" }

[[bench]]
name = "codec_benchmarks"
harness = false

[[bench]]
name = "diff_benchmarks"
harness = false

[[bin]]
name = "parse_events"
path = "src/bin/parse_events.rs"

[[bin]]
name = "analyze_events"
path = "src/bin/analyze_events.rs"

[[bin]]
name = "eval_runner"
path = "src/bin/eval_runner.rs"

[lints]
workspace = true
