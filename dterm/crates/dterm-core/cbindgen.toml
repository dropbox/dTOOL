# cbindgen configuration for dterm-core
# Generate C header with: cbindgen --config cbindgen.toml --crate dterm-core --output include/dterm.h

language = "C"

# Header options
header = """
/*
 * dterm-core C API
 *
 * High-performance terminal emulation library.
 *
 * This header provides bindings for:
 * - Parser: Low-level VT parsing with callbacks
 * - Grid: Terminal grid manipulation
 * - Terminal: High-level terminal emulation
 * - Search: Trigram-indexed search with bloom filter
 * - Checkpoint: Session persistence and crash recovery
 * - GPU Renderer: wgpu-based GPU rendering (Phase 3.3)
 *
 * Thread Safety: All types are NOT thread-safe.
 * Use external synchronization if needed.
 */

// Enable all FFI functions
#define DTERM_FFI 1

// Enable GPU renderer FFI (requires wgpu)
#define DTERM_GPU 1

// Undefine conflicting macOS macros before redefining
#ifdef PAGE_SIZE
#undef PAGE_SIZE
#endif
"""

include_guard = "DTERM_H"
include_version = true
autogen_warning = "/* Warning: this file is autogenerated by cbindgen. Don't modify this manually. */"
documentation_style = "c99"

[export]
include = [
    "DtermParser",
    "DtermGrid",
    "DtermTerminal",
    "DtermAction",
    "DtermActionType",
    "DtermCell",
    "DtermStyle",
    "DtermModes",
    "DtermSearch",
    "DtermSearchMatch",
    "DtermSearchDirection",
    "DtermCheckpoint",
    "DtermMouseMode",
    "DtermMouseEncoding",
    "DtermClipboardSelection",
    "DtermClipboardOpType",
    "DtermClipboardOp",
    # Shell integration (OSC 133)
    "DtermShellState",
    "DtermBlockState",
    "DtermOutputBlock",
    # Callback types
    "DtermWindowOpType",
    "DtermWindowOp",
    "DtermWindowResponse",
    "DtermShellEventType",
    "DtermShellEvent",
    # UI Bridge (Phase 13)
    "DtermUIBridge",
    "DtermUIState",
    "DtermUITerminalState",
    "DtermUIEventKind",
    "DtermUIErrorCode",
    "DtermUIEventInfo",
    # GPU Renderer (Phase 3.3)
    "DtermGpuRenderer",
    "DtermRenderError",
    "DtermDamageRegion",
    "DtermRendererConfig",
    "DtermFrameHandle",
    "DtermFrameStatus",
    "RendererInner",
    "DtermAtlasConfig",
    # GPU Renderer P0 additions for DashTerm2
    "DtermCursorStyle",
    "DtermBlendMode",
    "DtermRenderResult",
    "DtermHybridRenderer",
    "DtermCellVertex",
    "DtermUniforms",
    "DtermGlyphEntry",
    # Image texture cache for Sixel/Kitty/iTerm2 images (Phase 13.2)
    "DtermImageCache",
    "DtermImageFormat",
    "DtermImagePlacement",
]
exclude = ["FfiSink", "ClipboardCallbackState", "Style", "StyleAttrs", "PAGE_SIZE", "Page"]

[export.rename]
"DtermParser" = "dterm_parser_t"
"DtermGrid" = "dterm_grid_t"
"DtermTerminal" = "dterm_terminal_t"
"DtermAction" = "dterm_action_t"
"DtermActionType" = "dterm_action_type_t"
"DtermCell" = "dterm_cell_t"
"DtermStyle" = "dterm_style_t"
"DtermModes" = "dterm_modes_t"
"DtermSearch" = "dterm_search_t"
"DtermSearchMatch" = "dterm_search_match_t"
"DtermSearchDirection" = "dterm_search_direction_t"
"DtermCheckpoint" = "dterm_checkpoint_t"

[enum]
rename_variants = "ScreamingSnakeCase"
# Prefix with type name to avoid enum value collisions (OK, NULL_POINTER, etc.)
prefix_with_name = true

[fn]
prefix = ""
postfix = ""

[struct]
derive_eq = true
derive_neq = true

[parse]
parse_deps = false

[defines]
# Map Rust cfg(feature = "ffi") to DTERM_FFI which we define at the top
"feature = ffi" = "DTERM_FFI"
# Map Rust cfg(feature = "gpu") to DTERM_GPU
"feature = gpu" = "DTERM_GPU"
